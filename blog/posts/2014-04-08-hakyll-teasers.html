<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <title>Reichert Brothers - Teasers in Hakyll</title>
        <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" />
        <link rel="stylesheet" type="text/css" href="../../css/default.css" />
        <link rel="stylesheet" type="text/css" href="../../css/syntax.css" />
    </head>
    <body>
      <div class="page-container">
      	<!-- top navbar -->
          <div class="navbar navbar-default" role="navigation">
            <div class="container">
          	  <div class="navbar-header">
                   <button type="button" class="navbar-toggle" data-toggle="offcanvas" data-target=".sidebar-nav">
                     <span class="icon-bar"></span>
                     <span class="icon-bar"></span>
                     <span class="icon-bar"></span>
                   </button>
                   <a class="navbar-brand" href="../../">Reichert Brothers :: A Haskell Development and Consulting Company</a>
          	  </div>
            </div>
          </div>
          <div class="container">
            <div class="row row-offcanvas row-offcanvas-left">
              <!-- sidebar -->
              <div class="col-xs-6 col-sm-3 sidebar-offcanvas navbar-collapse" id="sidebar" role="navigation">
                  <a href="../../"><img class="logo" src="../../images/RBlogo_noname.png" width="80" /></a>
                  <ul class="nav">
                    <li class="active"><a href="../../">Home</a></li>
                    <li><a href="../../about.html">About</a></li>
                    <li><a href="../../services.html">Services</a></li>
                    <li><a href="../../portfolio.html">Portfolio</a></li>
                    <li><a href="../../contact.html">Contact</a></li>
                    <li><a href="../../blog.html">Blog</a></li>
                  </ul>
             </div>
              <!-- main area -->
              <div class="col-xs-12 col-sm-9">
                <div id="content">
                    <h1>Teasers in Hakyll</h1>
                    <div class="info">
    Posted on April  8, 2014
    
        by Christopher Reichert
    
</div>

<div style="text-align:center" markdown="1">
<p><img src="../../images/haskell_logo1.png" alt="Hakyll Lambda" style="height: 250px;" /></p>
</div>
<p>While building this blog, one of the primary issues I faced was figuring out how to implement post teasers. Most of the resources I found were using teasers in an rss or atom feed. The <a href="http://jaspervdj.be/hakyll/tutorials/using-teasers-in-hakyll.html">Hakyll tutorial</a> on teasers was helpful but I found I needed a little more handholding. Partially, because I misunderstood how template contexts work in Hakyll.</p>
<p>This post describes how to implement teasers in Hakyll on the default generated test site.</p>
<!--more-->
<h3 id="generate-test-site">Generate Test Site</h3>
<p>Say you generate a site <code>foo</code>:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash">    <span class="kw">hakyll-init</span> foo
    <span class="kw">cd</span> foo</code></pre></div>
<p>Run the site to view the existing list of posts.</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash">    <span class="kw">ghc</span> --make -threaded site.hs
    <span class="kw">./site</span> preview</code></pre></div>
<p>Point your browser to <a href="http://localhost:8000" class="uri">http://localhost:8000</a>. A list of posts should be displaying on the homepage. All is good.</p>
<p>The goal is to show a preview of each post in the post-list.html template. This would be visible on the homepage. Luckily, Hakyll has builtin functions to support extracting this information.</p>
<h3 id="modifying-the-html-templates">Modifying the HTML Templates</h3>
<p>What would this look like from an html perspective?</p>
<p>First, we need to add a template variable for the teaser to our post-list.html template. This way, a preview is shown every time we use the post-list template.</p>
<p>This is the html template for a list of posts before we add the teaser:</p>
<div class="sourceCode"><pre class="sourceCode html"><code class="sourceCode html">    <span class="kw">&lt;ul&gt;</span>
        $for(posts)$
            <span class="kw">&lt;li&gt;</span>
                <span class="kw">&lt;a</span><span class="ot"> href=</span><span class="st">&quot;$url$&quot;</span><span class="kw">&gt;</span>$title$<span class="kw">&lt;/a&gt;</span> - $date$
            <span class="kw">&lt;/li&gt;</span>
        $endfor$
    <span class="kw">&lt;/ul&gt;</span></code></pre></div>
<p>Now we will add a variable <code>$teaser$</code>:</p>
<div class="sourceCode"><pre class="sourceCode html"><code class="sourceCode html">    <span class="kw">&lt;ul&gt;</span>
        $for(posts)$
            <span class="kw">&lt;li&gt;</span>
                <span class="kw">&lt;a</span><span class="ot"> href=</span><span class="st">&quot;$url$&quot;</span><span class="kw">&gt;</span>$title$<span class="kw">&lt;/a&gt;</span> - $date$
                <span class="kw">&lt;p&gt;</span>
                $if(teaser)$
                    $teaser$
                $else$
                    $body$
                $endif$
                <span class="kw">&lt;/p&gt;</span>
            <span class="kw">&lt;/li&gt;</span>
        $endfor$
    <span class="kw">&lt;/ul&gt;</span></code></pre></div>
<p>If you do not plan on defining <code>&lt;!--more--&gt;</code> in each blog post then you should conditionally check for <span class="math inline"><em>t</em><em>e</em><em>a</em><em>s</em><em>e</em><em>r</em></span>:</p>
<pre><code>$if(teaser)$
    $teaser$
$else$
    $body$
$endif$</code></pre>
<p>Hakyll’s <code>teaserField</code> function (used to build teasers) will fail if the <code>&lt;!--more--&gt;</code> tag is not defined in the post. The <code>&lt;!--more--&gt;</code> tag tells Hakyll where the teaser stops.</p>
<h3 id="the-haskell-code">The Haskell Code</h3>
<p>Now that we have added the <code>$teaser$</code> value to our template we need to make sure we add the Haskell code to add the teasers to our context. Open up <code>site.hs</code> in your favorite editor:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash">    <span class="kw">vim</span> site.hs</code></pre></div>
<p>First, we must save a snapshot when generating posts. This must be done before any templates are applied:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">    match <span class="st">&quot;posts/*&quot;</span> <span class="fu">$</span> <span class="kw">do</span>
        route <span class="fu">$</span> setExtension <span class="st">&quot;html&quot;</span>
        compile <span class="fu">$</span> pandocCompiler
            <span class="fu">&gt;&gt;=</span> saveSnapshot <span class="st">&quot;content&quot;</span>
            <span class="fu">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">&quot;templates/post.html&quot;</span>    postCtx
            <span class="fu">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">&quot;templates/default.html&quot;</span> postCtx</code></pre></div>
<p>We save the snapshot <code>content</code> during the compilation phase. Now, we must get the teaser from the same snapshot when loading a list of posts. Posts are added to a context using the <code>listField</code> function. Here is an example of a route that loads a list of posts:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">    match <span class="st">&quot;index.html&quot;</span> <span class="fu">$</span> <span class="kw">do</span>
        route idRoute
        compile <span class="fu">$</span> <span class="kw">do</span>
            posts <span class="ot">&lt;-</span> recentFirst <span class="fu">=&lt;&lt;</span> loadAll <span class="st">&quot;posts/*&quot;</span> 
            <span class="kw">let</span> indexCtx <span class="fu">=</span>
                    listField <span class="st">&quot;posts&quot;</span> postCtx (return posts) <span class="ot">`mappend`</span>
                    constField <span class="st">&quot;title&quot;</span> <span class="st">&quot;Home&quot;</span>                <span class="ot">`mappend`</span>
                    defaultContext
        <span class="fu">...</span></code></pre></div>
<p>We must use the <code>teaserField</code> function to add the teasers to our context for each post. Thus, we want to add the teaser to the post context for each post.</p>
<p>We define a convencience function to create a context for teasers based off the post’s context <code>postCtx</code>:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">    teaserCtx <span class="fu">=</span> teaserField <span class="st">&quot;teaser&quot;</span> <span class="st">&quot;content&quot;</span> <span class="ot">`mappend`</span> postCtx</code></pre></div>
<p>Now we can use this context in each post. We must also load the snapshots during the compile phase using <code>loadAllSnapshots</code>:</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">    match <span class="st">&quot;index.html&quot;</span> <span class="fu">$</span> <span class="kw">do</span>
        route idRoute
        compile <span class="fu">$</span> <span class="kw">do</span>
            posts <span class="ot">&lt;-</span> recentFirst <span class="fu">=&lt;&lt;</span> loadAllSnapshots <span class="st">&quot;posts/*&quot;</span> <span class="st">&quot;content&quot;</span>
            <span class="kw">let</span> indexCtx <span class="fu">=</span>
                    listField <span class="st">&quot;posts&quot;</span> teaserCtx (return posts) <span class="ot">`mappend`</span>
                    constField <span class="st">&quot;title&quot;</span> <span class="st">&quot;Home&quot;</span>                <span class="ot">`mappend`</span>
                    defaultContext
        <span class="fu">...</span></code></pre></div>
<p>You should do this for every page that uses the post-list template. In our case this also include the archive page.</p>
<p>Now you should be able to see teasers on your posts: <a href="http://localhost:8000" class="uri">http://localhost:8000</a></p>
<p>Happy Hacking.</p>

<hr>
<!-- the comment box -->
<div class="well">
    <div id="disqus_thread"></div>
      <script type="text/javascript">
          /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
          var disqus_shortname = 'reichertbrothers'; // required: replace example with your forum shortname

          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

                </div>
              </div><!-- /.col-xs-12 main -->
          </div><!--/.row-->
        </div><!--/.container-->
        <div class="footer">
          <div class="container" style="padding: 40px;">
              Copyright © 2013-2014, Reichert Brothers LLC.
              <br />
               Site proudly generated by
              <a href="http://jaspervdj.be/hakyll">Hakyll</a>
          </div>
        </div>
      </div><!--/.page-container-->
      <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script>
      <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
      <script src="../../js/scripts.js"></script>
    </body>
</html>
